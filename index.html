<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å—Ç–æ—Ä–∏—è –ø–æ –≠–º–æ–¥–∑–∏ üìö</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .emoji-input-container {
            margin-bottom: 20px;
        }

        .emoji-input {
            width: 100%;
            font-size: 2em;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            background: #f8f8f8;
        }

        .emoji-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: scale(1.02);
        }

        .suggestions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .suggestion-btn {
            background: #f0f0f0;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
        }

        .suggestion-btn:hover {
            background: #667eea;
            transform: scale(1.1);
        }

        .genre-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .genre-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .genre-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .genre-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .generate-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .generate-btn.loading {
            color: transparent;
        }

        .generate-btn.loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .story-container {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            min-height: 200px;
            animation: fadeIn 0.5s ease-out;
            display: none;
        }

        .story-container.show {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .story-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .story-text {
            color: #555;
            line-height: 1.8;
            font-size: 1em;
            white-space: pre-wrap;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            animation: shake 0.5s;
        }

        .error-message.show {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .info-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.85em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö –ò—Å—Ç–æ—Ä–∏—è –ø–æ –≠–º–æ–¥–∑–∏</h1>
        <p class="subtitle">–í–≤–µ–¥–∏ —ç–º–æ–¥–∑–∏ –∏ –ø–æ–ª—É—á–∏ —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é!</p>
        
        <div class="info-badge">
            üí° –î–µ–º–æ-–≤–µ—Ä—Å–∏—è
        </div>

        <div class="emoji-input-container">
            <input type="text" 
                   class="emoji-input" 
                   id="emojiInput" 
                   placeholder="–í–≤–µ–¥–∏ —ç–º–æ–¥–∑–∏ –∑–¥–µ—Å—å... ü¶Ñüåà‚ú®"
                   maxlength="20">
        </div>

        <div class="suggestions">
            <button class="suggestion-btn" onclick="addEmoji('üê∏üëëüíé')">üê∏üëëüíé</button>
            <button class="suggestion-btn" onclick="addEmoji('üöÄüëΩüåç')">üöÄüëΩüåç</button>
            <button class="suggestion-btn" onclick="addEmoji('üßô‚Äç‚ôÇÔ∏èüêâüó°Ô∏è')">üßô‚Äç‚ôÇÔ∏èüêâüó°Ô∏è</button>
            <button class="suggestion-btn" onclick="addEmoji('üè¥‚Äç‚ò†Ô∏èü¶úüí∞')">üè¥‚Äç‚ò†Ô∏èü¶úüí∞</button>
            <button class="suggestion-btn" onclick="addEmoji('üëªüèöÔ∏èüïØÔ∏è')">üëªüèöÔ∏èüïØÔ∏è</button>
        </div>

        <div class="genre-selector">
            <button class="genre-btn active" onclick="selectGenre(this, '—Å–∫–∞–∑–∫–∞')">üßö –°–∫–∞–∑–∫–∞</button>
            <button class="genre-btn" onclick="selectGenre(this, '–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ')">üó∫Ô∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</button>
            <button class="genre-btn" onclick="selectGenre(this, '–¥–µ—Ç–µ–∫—Ç–∏–≤')">üîç –î–µ—Ç–µ–∫—Ç–∏–≤</button>
            <button class="genre-btn" onclick="selectGenre(this, '—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞')">üöÄ –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</button>
            <button class="genre-btn" onclick="selectGenre(this, '–∫–æ–º–µ–¥–∏—è')">üòÑ –ö–æ–º–µ–¥–∏—è</button>
        </div>

        <button class="generate-btn" id="generateBtn" onclick="generateStory()">
            ‚ú® –°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        </button>

        <div class="story-container" id="storyContainer">
            <h2 class="story-title">
                <span>üìñ</span>
                <span>–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è</span>
            </h2>
            <div class="story-text" id="storyText"></div>
        </div>

        <div class="error-message" id="errorMessage"></div>
    </div>

    <script>
        let selectedGenre = '—Å–∫–∞–∑–∫–∞';
        let isGenerating = false;

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —ç–º–æ–¥–∑–∏ —Å –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
        const emojiMeanings = {
            'üê∏': { name: '–ª—è–≥—É—à–∫–∞', type: '–∂–∏–≤–æ—Ç–Ω–æ–µ' },
            'üëë': { name: '–∫–æ—Ä–æ–Ω–∞', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üíé': { name: '–∞–ª–º–∞–∑', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üöÄ': { name: '—Ä–∞–∫–µ—Ç–∞', type: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç' },
            'üëΩ': { name: '–ø—Ä–∏—à–µ–ª–µ—Ü', type: '–ø–µ—Ä—Å–æ–Ω–∞–∂' },
            'üåç': { name: '–ó–µ–º–ª—è', type: '–º–µ—Å—Ç–æ' },
            'üßô‚Äç‚ôÇÔ∏è': { name: '–≤–æ–ª—à–µ–±–Ω–∏–∫', type: '–ø–µ—Ä—Å–æ–Ω–∞–∂' },
            'üêâ': { name: '–¥—Ä–∞–∫–æ–Ω', type: '—Å—É—â–µ—Å—Ç–≤–æ' },
            'üó°Ô∏è': { name: '–º–µ—á', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üè¥‚Äç‚ò†Ô∏è': { name: '–ø–∏—Ä–∞—Ç—Å–∫–∏–π —Ñ–ª–∞–≥', type: '—Å–∏–º–≤–æ–ª' },
            'ü¶ú': { name: '–ø–æ–ø—É–≥–∞–π', type: '–∂–∏–≤–æ—Ç–Ω–æ–µ' },
            'üí∞': { name: '–º–µ—à–æ–∫ –∑–æ–ª–æ—Ç–∞', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üëª': { name: '–ø—Ä–∏–∑—Ä–∞–∫', type: '—Å—É—â–µ—Å—Ç–≤–æ' },
            'üèöÔ∏è': { name: '—Å—Ç–∞—Ä—ã–π –¥–æ–º', type: '–º–µ—Å—Ç–æ' },
            'üïØÔ∏è': { name: '—Å–≤–µ—á–∞', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'ü¶Ñ': { name: '–µ–¥–∏–Ω–æ—Ä–æ–≥', type: '—Å—É—â–µ—Å—Ç–≤–æ' },
            'üåà': { name: '—Ä–∞–¥—É–≥–∞', type: '—è–≤–ª–µ–Ω–∏–µ' },
            '‚ú®': { name: '–≤–æ–ª—à–µ–±—Å—Ç–≤–æ', type: '—è–≤–ª–µ–Ω–∏–µ' },
            'üêª': { name: '–º–µ–¥–≤–µ–¥—å', type: '–∂–∏–≤–æ—Ç–Ω–æ–µ' },
            'üåô': { name: '–ª—É–Ω–∞', type: '–æ–±—ä–µ–∫—Ç' },
            '‚≠ê': { name: '–∑–≤–µ–∑–¥–∞', type: '–æ–±—ä–µ–∫—Ç' },
            'üîÆ': { name: '–º–∞–≥–∏—á–µ—Å–∫–∏–π —à–∞—Ä', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üè∞': { name: '–∑–∞–º–æ–∫', type: '–º–µ—Å—Ç–æ' },
            'üßö': { name: '—Ñ–µ—è', type: '–ø–µ—Ä—Å–æ–Ω–∞–∂' },
            'üé≠': { name: '–º–∞—Å–∫–∏', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'ü¶ä': { name: '–ª–∏—Å–∞', type: '–∂–∏–≤–æ—Ç–Ω–æ–µ' },
            'üå∫': { name: '—Ü–≤–µ—Ç–æ–∫', type: '—Ä–∞—Å—Ç–µ–Ω–∏–µ' },
            'üé™': { name: '—Ü–∏—Ä–∫', type: '–º–µ—Å—Ç–æ' },
            'ü§ñ': { name: '—Ä–æ–±–æ—Ç', type: '–ø–µ—Ä—Å–æ–Ω–∞–∂' },
            'üõ∏': { name: '–ù–õ–û', type: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç' },
            'üß∏': { name: '–ø–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üé®': { name: '–ø–∞–ª–∏—Ç—Ä–∞', type: '–ø—Ä–µ–¥–º–µ—Ç' },
            'üéµ': { name: '–º—É–∑—ã–∫–∞', type: '—è–≤–ª–µ–Ω–∏–µ' },
            'üçÑ': { name: '–≥—Ä–∏–±', type: '—Ä–∞—Å—Ç–µ–Ω–∏–µ' },
            'ü¶ã': { name: '–±–∞–±–æ—á–∫–∞', type: '–∂–∏–≤–æ—Ç–Ω–æ–µ' },
            'üåä': { name: '–≤–æ–ª–Ω–∞', type: '—è–≤–ª–µ–Ω–∏–µ' },
            '‚ö°': { name: '–º–æ–ª–Ω–∏—è', type: '—è–≤–ª–µ–Ω–∏–µ' },
            'üî•': { name: '–æ–≥–æ–Ω—å', type: '—è–≤–ª–µ–Ω–∏–µ' },
            '‚ùÑÔ∏è': { name: '—Å–Ω–µ–∂–∏–Ω–∫–∞', type: '—è–≤–ª–µ–Ω–∏–µ' },
            'üå∏': { name: '—Å–∞–∫—É—Ä–∞', type: '—Ä–∞—Å—Ç–µ–Ω–∏–µ' }
        };

        // –®–∞–±–ª–æ–Ω—ã –∏—Å—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤
        const storyTemplates = {
            '—Å–∫–∞–∑–∫–∞': {
                beginnings: [
                    '–í —Ç—Ä–∏–¥–µ–≤—è—Ç–æ–º —Ü–∞—Ä—Å—Ç–≤–µ, –≤ —Ç—Ä–∏–¥–µ—Å—è—Ç–æ–º –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ –∂–∏–ª-–±—ã–ª {character}.',
                    '–î–∞–≤–Ω—ã–º-–¥–∞–≤–Ω–æ, –∫–æ–≥–¥–∞ {object} –æ–±–ª–∞–¥–∞–ª –≤–æ–ª—à–µ–±–Ω–æ–π —Å–∏–ª–æ–π, —Å–ª—É—á–∏–ª–∞—Å—å —ç—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è.',
                    '–ñ–∏–ª-–±—ã–ª {character}, –∫–æ—Ç–æ—Ä—ã–π –º–µ—á—Ç–∞–ª –Ω–∞–π—Ç–∏ {object}.',
                    '–í –¥–∞–ª—ë–∫–æ–π —Å—Ç—Ä–∞–Ω–µ, –≥–¥–µ {phenomenon} —Å–ª—É—á–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞—à–∞ —Å–∫–∞–∑–∫–∞.'
                ],
                middles: [
                    '–û–¥–Ω–∞–∂–¥—ã {character} –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª {animal}, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–∞–∑–∞–ª: "–Ø –∑–Ω–∞—é, –≥–¥–µ —Å–ø—Ä—è—Ç–∞–Ω {object}!"',
                    '–ù–æ –∑–ª–æ–π –∫–æ–ª–¥—É–Ω —É–∫—Ä–∞–ª {object} –∏ —Å–ø—Ä—è—Ç–∞–ª –µ–≥–æ –≤ {place}. –¢–æ–ª—å–∫–æ {character} –º–æ–≥ –µ–≥–æ –≤–µ—Ä–Ω—É—Ç—å.',
                    '{character} –¥–æ–ª–∂–µ–Ω –±—ã–ª –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ {place}, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –≤–æ–ª—à–µ–±–Ω—ã–π {object}.',
                    '–¢—Ä–∏ –¥–Ω—è –∏ —Ç—Ä–∏ –Ω–æ—á–∏ {character} –∏—Å–∫–∞–ª {object}, –ø–æ–∫–∞ –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª –º—É–¥—Ä–æ–≥–æ {animal}.'
                ],
                endings: [
                    '–ò —Å —Ç–µ—Ö –ø–æ—Ä {character} –∏ {animal} –∂–∏–ª–∏ –¥–æ–ª–≥–æ –∏ —Å—á–∞—Å—Ç–ª–∏–≤–æ, –∞ {object} –ø—Ä–∏–Ω–æ—Å–∏–ª –∏–º —É–¥–∞—á—É.',
                    '–¢–∞–∫ {character} –ø–æ–Ω—è–ª, —á—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ - —ç—Ç–æ –¥—Ä—É–∂–±–∞ —Å {animal}, –∞ –Ω–µ {object}.',
                    '–í–µ—Ä–Ω—É–≤ {object} –Ω–∞ –º–µ—Å—Ç–æ, {character} —Å–ø–∞—Å –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ –∏ —Å—Ç–∞–ª –≥–µ—Ä–æ–µ–º.',
                    '–ò —Ç–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤–∏–¥–∏—à—å {phenomenon}, –∑–Ω–∞–π - —ç—Ç–æ {character} —Ç–≤–æ—Ä–∏—Ç —á—É–¥–µ—Å–∞.'
                ]
            },
            '–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ': {
                beginnings: [
                    '{character} –ø—Ä–æ—Å–Ω—É–ª—Å—è –≤ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–º {place} —Å {object} –≤ —Ä—É–∫–∞—Ö.',
                    '–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –≤ –ø–æ–∏—Å–∫–∞—Ö {object} –ø—Ä–∏–≤–µ–ª–∞ {character} –≤ —Å–∞–º–æ–µ —Å–µ—Ä–¥—Ü–µ {place}.',
                    '–ö–∞—Ä—Ç–∞ —É–∫–∞–∑—ã–≤–∞–ª–∞, —á—Ç–æ {object} —Å–ø—Ä—è—Ç–∞–Ω —Ç–∞–º, –≥–¥–µ {phenomenon} –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å –∑–µ–º–ª—ë–π.',
                    '{character} –∏ –≤–µ—Ä–Ω—ã–π {animal} –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –≤ –æ–ø–∞—Å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ.'
                ],
                middles: [
                    '–ü—Ä–µ–æ–¥–æ–ª–µ–≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ª–æ–≤—É—à–µ–∫ –≤ {place}, –æ–Ω–∏ –Ω–∞–∫–æ–Ω–µ—Ü —É–≤–∏–¥–µ–ª–∏ {object}.',
                    '–ù–æ –ø—É—Ç—å –ø—Ä–µ–≥—Ä–∞–∂–¥–∞–ª –æ–≥—Ä–æ–º–Ω—ã–π {creature}, –æ—Ö—Ä–∞–Ω—è–≤—à–∏–π {object} –≤–µ–∫–∞–º–∏.',
                    '{transport} —Å–ª–æ–º–∞–ª—Å—è –ø–æ—Å—Ä–µ–¥–∏ –ø—É—Ç–∏, –∏ {character} –ø—Ä–∏—à–ª–æ—Å—å –∏–¥—Ç–∏ –ø–µ—à–∫–æ–º —á–µ—Ä–µ–∑ {place}.',
                    '–í –¥—Ä–µ–≤–Ω–µ–º {place} {character} –Ω–∞—à—ë–ª –ø–æ–¥—Å–∫–∞–∑–∫—É - {object} –æ—Ö—Ä–∞–Ω—è–µ—Ç {creature}.'
                ],
                endings: [
                    '–° {object} –≤ —Ä—É–∫–∞—Ö, {character} –≤–µ—Ä–Ω—É–ª—Å—è –¥–æ–º–æ–π –Ω–∞—Å—Ç–æ—è—â–∏–º –≥–µ—Ä–æ–µ–º.',
                    '–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å, –Ω–æ {character} –∑–Ω–∞–ª - –≤–ø–µ—Ä–µ–¥–∏ –∂–¥—É—Ç –Ω–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è.',
                    '{object} –æ–∫–∞–∑–∞–ª—Å—è –∫–ª—é—á–æ–º –∫ –µ—â—ë –±–æ–ª—å—à–µ–π —Ç–∞–π–Ω–µ, –∏ {character} –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –¥–∞–ª—å—à–µ.',
                    '–¢–∞–∫ {character} –∏ {animal} —Å—Ç–∞–ª–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–º–∏ –∏—Å–∫–∞—Ç–µ–ª—è–º–∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π.'
                ]
            },
            '–¥–µ—Ç–µ–∫—Ç–∏–≤': {
                beginnings: [
                    '–í –ø–æ–ª–Ω–æ—á—å –∏–∑ –º—É–∑–µ—è –ø—Ä–æ–ø–∞–ª {object}, –∞ –Ω–∞ –º–µ—Å—Ç–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –æ—Å—Ç–∞–ª—Å—è —Ç–æ–ª—å–∫–æ {object2}.',
                    '–î–µ—Ç–µ–∫—Ç–∏–≤ {character} –ø–æ–ª—É—á–∏–ª —Å—Ç—Ä–∞–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ: "–ù–∞–π–¥–∏ {object} –≤ {place}".',
                    '–ö–æ–≥–¥–∞ {phenomenon} –æ–∑–∞—Ä–∏–ª–æ –Ω–µ–±–æ, {character} –ø–æ–Ω—è–ª - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–∞—è –∫—Ä–∞–∂–∞ {object}.',
                    '{character} —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–ª –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ {object} —É–∂–µ —Ç—Ä–µ—Ç–∏–π –¥–µ–Ω—å.'
                ],
                middles: [
                    '–°–ª–µ–¥—ã –ø—Ä–∏–≤–µ–ª–∏ –≤ {place}, –≥–¥–µ {animal} –æ—Ö—Ä–∞–Ω—è–ª —Ç–∞–π–Ω–∏–∫ —Å —É–ª–∏–∫–∞–º–∏.',
                    '–ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –ø–∞–ª–æ –Ω–∞ {character2}, –Ω–æ –∞–ª–∏–±–∏ –±—ã–ª–æ –∂–µ–ª–µ–∑–Ω—ã–º - –≤ —ç—Ç–æ –≤—Ä–µ–º—è –±—ã–ª {phenomenon}.',
                    '–í {place} –Ω–∞—à–ª–∞—Å—å –≤–∞–∂–Ω–∞—è —É–ª–∏–∫–∞ - {object2}, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–π –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫—É.',
                    '{character} –ø–æ–Ω—è–ª: {object} —É–∫—Ä–∞–¥–µ–Ω, —á—Ç–æ–±—ã –æ—Ç–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ –æ—Ç {object2}.'
                ],
                endings: [
                    '–ü—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–æ–º –æ–∫–∞–∑–∞–ª—Å—è {character2}, –∞ {object} –±—ã–ª —Å–ø—Ä—è—Ç–∞–Ω –≤ {place}.',
                    '–†–∞—Å–∫—Ä—ã–≤ –¥–µ–ª–æ, {character} –≤–µ—Ä–Ω—É–ª {object} –≤–ª–∞–¥–µ–ª—å—Ü—É –∏ –ø–æ–ª—É—á–∏–ª –Ω–∞–≥—Ä–∞–¥—É.',
                    '–û–∫–∞–∑–∞–ª–æ—Å—å, {animal} –≤—Å—ë –≤—Ä–µ–º—è –∑–Ω–∞–ª, –≥–¥–µ {object}, –Ω–æ –Ω–µ –º–æ–≥ —Å–∫–∞–∑–∞—Ç—å.',
                    '–î–µ–ª–æ —Ä–∞—Å–∫—Ä—ã—Ç–æ: {object} –Ω–∏–∫—Ç–æ –Ω–µ –∫—Ä–∞–ª, —ç—Ç–æ –±—ã–ª–∞ —Ö–∏—Ç—Ä–∞—è –∏–Ω—Å—Ü–µ–Ω–∏—Ä–æ–≤–∫–∞.'
                ]
            },
            '—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞': {
                beginnings: [
                    '–í 2157 –≥–æ–¥—É {character} –æ–±–Ω–∞—Ä—É–∂–∏–ª —Å–∏–≥–Ω–∞–ª –æ—Ç {object} —Å –ø–ª–∞–Ω–µ—Ç—ã {place}.',
                    '–ö–æ–≥–¥–∞ {transport} –ø—Ä–∏–∑–µ–º–ª–∏–ª—Å—è –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π –ø–ª–∞–Ω–µ—Ç–µ, {character} —É–≤–∏–¥–µ–ª {phenomenon}.',
                    '{character} - –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–Ω–∏—Ç –≤—Ä–µ–º–µ–Ω–∞ –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è {creature}.',
                    '–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç —Å {object} –æ—Ç–∫—Ä—ã–ª –ø–æ—Ä—Ç–∞–ª –≤ –º–∏—Ä, –≥–¥–µ –ø—Ä–∞–≤–∏—Ç {character2}.'
                ],
                middles: [
                    '{transport} –ª–µ—Ç–µ–ª —Å–∫–≤–æ–∑—å {phenomenon}, –∫–æ–≥–¥–∞ {character} –∑–∞–º–µ—Ç–∏–ª —Å—Ç—Ä–∞–Ω–Ω—ã–π {object}.',
                    '–ù–∞ –ø–ª–∞–Ω–µ—Ç–µ {character} –≤—Å—Ç—Ä–µ—Ç–∏–ª {creature}, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–∫–∞–ª —Ç–æ—Ç –∂–µ {object}.',
                    '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç {character2} –∑–∞—Ö–≤–∞—Ç–∏–ª {place} —Å –ø–æ–º–æ—â—å—é {object}.',
                    '{phenomenon} –æ–∫–∞–∑–∞–ª–æ—Å—å –ø–æ—Ä—Ç–∞–ª–æ–º, –≤–µ–¥—É—â–∏–º –∫ {object} –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–π –º–æ—â–∏.'
                ],
                endings: [
                    '{character} —Å–ø–∞—Å –≥–∞–ª–∞–∫—Ç–∏–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è {object} –ø—Ä–æ—Ç–∏–≤ {creature}.',
                    '–í–µ—Ä–Ω—É–≤—à–∏—Å—å –Ω–∞ –ó–µ–º–ª—é, {character} –ø—Ä–∏–Ω—ë—Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é {object}, –∏–∑–º–µ–Ω–∏–≤—à—É—é –º–∏—Ä.',
                    '–¢–∞–∫ –Ω–∞—á–∞–ª–∞—Å—å –Ω–æ–≤–∞—è —ç—Ä–∞, –≥–¥–µ {character} –∏ {creature} –∂–∏–≤—É—Ç –≤ –º–∏—Ä–µ.',
                    '{object} –æ–∫–∞–∑–∞–ª—Å—è –∫–ª—é—á–æ–º –∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è–º —Å–∫–≤–æ–∑—å {phenomenon}.'
                ]
            },
            '–∫–æ–º–µ–¥–∏—è': {
                beginnings: [
                    '{character} —Ä–µ—à–∏–ª —Å—Ç–∞—Ç—å —Å—É–ø–µ—Ä–≥–µ—Ä–æ–µ–º, –Ω–æ –≤–º–µ—Å—Ç–æ —Å—É–ø–µ—Ä—Å–∏–ª—ã –ø–æ–ª—É—á–∏–ª {object}.',
                    '–í—Å—ë –Ω–∞—á–∞–ª–æ—Å—å, –∫–æ–≥–¥–∞ {animal} —É–∫—Ä–∞–ª {object} –∏ —É–±–µ–∂–∞–ª –≤ {place}.',
                    '{character} –ø–µ—Ä–µ–ø—É—Ç–∞–ª {object} —Å {object2} –∏ —Å–ª—É—á–∞–π–Ω–æ –≤—ã–∑–≤–∞–ª {phenomenon}.',
                    '–ù–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è {character} –ø–æ–¥–∞—Ä–∏–ª–∏ {animal}, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–ª —Ç–æ–ª—å–∫–æ –µ—Å—Ç—å {object}.'
                ],
                middles: [
                    '–ü—ã—Ç–∞—è—Å—å –ø–æ–π–º–∞—Ç—å {animal}, {character} —Ä–∞–∑—Ä—É—à–∏–ª –ø–æ–ª–æ–≤–∏–Ω—É {place}.',
                    '{creature} –æ–∫–∞–∑–∞–ª—Å—è –≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Ü–µ–º –∏ –≤–º–µ—Å—Ç–æ –ª—é–¥–µ–π –µ–ª —Ç–æ–ª—å–∫–æ {object}.',
                    '–í {place} {character} –≤—Å—Ç—Ä–µ—Ç–∏–ª {character2}, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–∂–µ –∏—Å–∫–∞–ª {object}, –Ω–æ –¥–ª—è —Å–∞–ª–∞—Ç–∞.',
                    '–û–∫–∞–∑–∞–ª–æ—Å—å, {object} - —ç—Ç–æ –Ω–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ, –∞ –ª—é–±–∏–º–∞—è –∏–≥—Ä—É—à–∫–∞ {animal}.'
                ],
                endings: [
                    '–í –∏—Ç–æ–≥–µ {character} –∏ {animal} –æ—Ç–∫—Ä—ã–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –≥–¥–µ –ø–æ–¥–∞—é—Ç {object}.',
                    '–í—Å–µ —Å–º–µ—è–ª–∏—Å—å, –∫–æ–≥–¥–∞ —É–∑–Ω–∞–ª–∏, —á—Ç–æ {object} –≤—Å—ë –≤—Ä–µ–º—è –±—ã–ª —É {animal}.',
                    '{character} —Å—Ç–∞–ª –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–º –∫–æ–º–∏–∫–æ–º, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—è –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ {object}.',
                    '–ò —Ç–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π —Ä–∞–∑, –≤–∏–¥—è {phenomenon}, –≤—Å–µ –≤—Å–ø–æ–º–∏–Ω–∞—é—Ç –∏ —Å–º–µ—é—Ç—Å—è.'
                ]
            }
        };

        function addEmoji(emojis) {
            document.getElementById('emojiInput').value = emojis;
        }

        function selectGenre(button, genre) {
            document.querySelectorAll('.genre-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            selectedGenre = genre;
        }

        function parseEmojis(emojiString) {
            const emojis = [];
            const emojiRegex = /\p{Emoji}/gu;
            const matches = emojiString.match(emojiRegex);
            
            if (matches) {
                matches.forEach(emoji => {
                    if (emojiMeanings[emoji]) {
                        emojis.push({
                            emoji: emoji,
                            ...emojiMeanings[emoji]
                        });
                    } else {
                        // –î–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —ç–º–æ–¥–∑–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        emojis.push({
                            emoji: emoji,
                            name: '–∑–∞–≥–∞–¥–æ—á–Ω—ã–π —Å–∏–º–≤–æ–ª',
                            type: '–ø—Ä–µ–¥–º–µ—Ç'
                        });
                    }
                });
            }
            
            return emojis;
        }

        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateStoryFromTemplate(emojis, genre) {
            const template = storyTemplates[genre];
            const parsedEmojis = parseEmojis(emojis);
            
            if (parsedEmojis.length === 0) {
                return null;
            }

            // –°–æ–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ —Ç–∏–ø–∞–º
            const characters = parsedEmojis.filter(e => e.type === '–ø–µ—Ä—Å–æ–Ω–∞–∂' || e.type === '—Å—É—â–µ—Å—Ç–≤–æ');
            const objects = parsedEmojis.filter(e => e.type === '–ø—Ä–µ–¥–º–µ—Ç');
            const places = parsedEmojis.filter(e => e.type === '–º–µ—Å—Ç–æ');
            const animals = parsedEmojis.filter(e => e.type === '–∂–∏–≤–æ—Ç–Ω–æ–µ');
            const phenomena = parsedEmojis.filter(e => e.type === '—è–≤–ª–µ–Ω–∏–µ');
            const transports = parsedEmojis.filter(e => e.type === '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç');
            const creatures = parsedEmojis.filter(e => e.type === '—Å—É—â–µ—Å—Ç–≤–æ');

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–º–µ–Ω—ã –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
            function replacePlaceholders(text) {
                const replacements = {
                    '{character}': characters.length > 0 ? getRandomElement(characters).name : 
                                  animals.length > 0 ? getRandomElement(animals).name : 
                                  getRandomElement(parsedEmojis).name,
                    '{character2}': characters.length > 1 ? characters[1].name : 
                                   animals.length > 0 ? getRandomElement(animals).name : 
                                   '—Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–µ–∑–Ω–∞–∫–æ–º–µ—Ü',
                    '{object}': objects.length > 0 ? getRandomElement(objects).name : 
                               getRandomElement(parsedEmojis).name,
                    '{object2}': objects.length > 1 ? objects[1].name : 
                                parsedEmojis.length > 1 ? parsedEmojis[1].name : 
                                '—Å—Ç—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç',
                    '{place}': places.length > 0 ? getRandomElement(places).name : 
                              '—Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ',
                    '{animal}': animals.length > 0 ? getRandomElement(animals).name : 
                               creatures.length > 0 ? getRandomElement(creatures).name : 
                               '–∑–∞–≥–∞–¥–æ—á–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ',
                    '{phenomenon}': phenomena.length > 0 ? getRandomElement(phenomena).name : 
                                   '—Å—Ç—Ä–∞–Ω–Ω–æ–µ —è–≤–ª–µ–Ω–∏–µ',
                    '{transport}': transports.length > 0 ? getRandomElement(transports).name : 
                                  '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                    '{creature}': creatures.length > 0 ? getRandomElement(creatures).name : 
                                 animals.length > 0 ? getRandomElement(animals).name : 
                                 '—Å—É—â–µ—Å—Ç–≤–æ'
                };

                let result = text;
                for (const [placeholder, replacement] of Object.entries(replacements)) {
                    result = result.replace(new RegExp(placeholder, 'g'), replacement);
                }
                return result;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é
            const beginning = replacePlaceholders(getRandomElement(template.beginnings));
            const middle = replacePlaceholders(getRandomElement(template.middles));
            const ending = replacePlaceholders(getRandomElement(template.endings));

            return `${beginning}\n\n${middle}\n\n${ending}`;
        }

        async function generateStory() {
            const emojis = document.getElementById('emojiInput').value.trim();
            
            if (!emojis) {
                showError('–í–≤–µ–¥–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–º–æ–¥–∑–∏!');
                return;
            }

            if (isGenerating) return;

            isGenerating = true;
            const button = document.getElementById('generateBtn');
            button.classList.add('loading');
            button.disabled = true;

            // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
            setTimeout(() => {
                const story = generateStoryFromTemplate(emojis, selectedGenre);
                
                if (story) {
                    displayStory(story);
                } else {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–∏–µ —ç–º–æ–¥–∑–∏!');
                }

                isGenerating = false;
                button.classList.remove('loading');
                button.disabled = false;
            }, 1500);
        }

        function displayStory(story) {
            const container = document.getElementById('storyContainer');
            const textElement = document.getElementById('storyText');
            
            container.classList.add('show');
            textElement.textContent = story;
            
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.classList.add('show');
            
            setTimeout(() => {
                errorElement.classList.remove('show');
            }, 3000);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ —ç–º–æ–¥–∑–∏
        document.getElementById('emojiInput').addEventListener('input', function(e) {
            if (e.target.value) {
                e.target.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    e.target.style.transform = 'scale(1)';
                }, 200);
            }
        });
    </script>
</body>

</html>
